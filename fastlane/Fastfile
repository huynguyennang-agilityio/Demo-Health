default_platform(:ios)

platform :ios do

  desc "CI: Build Development IPA and upload to Firebase App Distribution"
  lane :ci_dev do
    UI.user_error!("This lane is CI-only") unless ENV['CI']

    # ✅ Pull certificate & provisioning profile via Match
    match(
      type: "adhoc",            # ad-hoc, appstore, development
      readonly: true,           
      git_url: ENV["MATCH_GIT_URL"],
      username: ENV["FASTLANE_USER"]
    )

    # ✅ Build app
    build_app(
      scheme: "MockWorkoutApp copy",
      export_method: "ad-hoc"
    )

    # ✅ Upload to Firebase
    firebase_app_distribution(
      app: ENV["FIREBASE_IOS_APP_ID"],
      testers: ENV["FIREBASE_TESTERS"],
      release_notes: "CI Development build via GitHub Actions"
    )
  end

end
